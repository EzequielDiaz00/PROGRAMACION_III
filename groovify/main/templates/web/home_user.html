<!DOCTYPE html>
<html lang="es">
{% load static %}
{% load song_filters %}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Groovify - Plataforma de Música</title>
  <link rel="stylesheet" href="{% static 'css/css2.css' %}">
  <link rel="icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
</head>

<body>
  <!-- Barra de navegación -->
  <header class="navbar">
    <div class="logo">
      <br>
      <h1>Groovify</h1>
      <br>
    </div>
    <nav>
      <ul>
        <li>
          <!-- Mostrar el correo electrónico del usuario -->
          {% if email %}
          <p>Bienvenido, <strong>{{ email }}</strong></p>
          {% else %}
          <p>Bienvenido, invitado</p>
          {% endif %}
        </li>
        <li>
          <a href="{% url 'logout' %}" onclick="return confirm('¿Estás seguro de que deseas cerrar sesión?')">
            Cerrar Sesión
          </a>
        </li>

      </ul>
    </nav>
  </header>

  <!-- Sección principal -->
  <main>
    <!-- Sección de la lista de canciones y reproductor en paralelo -->
    <section id="main" class="featured-song-player">
      {% load song_filters %}

      <section class="featured-song">
        <h2>Lista de Canciones Ordenadas por Artista</h2>
        <br>

        <!-- Campo de búsqueda -->
        <form method="get" action="{% url 'home_user' %}" class="search-form">
          <input type="text" name="query" placeholder="Buscar canciones..." class="search-input">
          <button type="submit" class="search-button">Buscar</button>
        </form>

        <!-- Lista de canciones -->
        <ul class="song-list">
          {% for song_url in song_urls|sort_by_artist %}
          <li class="song-item" data-file="{{ song_url }}">
            {{ song_url|extract_song_name }}
          </li>
          {% empty %}
          <li>No se encontraron canciones.</li>
          {% endfor %}
        </ul>
      </section>

      <!-- Reproductor a la par de la lista de canciones -->
      <section id="player" class="player">
        <img src="{% static 'img/logo-player-100.jpg' %}" alt="portada-song" class="portada-song">
        <div id="player_controls" class="player-controls">
          <button id="player_back">⏮️</button>
          <button id="player_play">▶️</button>
          <button id="player_pause">⏸</button>
          <button id="player_stop">⏹️</button>
          <button id="player_skip">⏭️</button>
        </div>
        <br>
        <div id="song_info" class="song-info">
          <p>Selecciona una canción para reproducir</p>
        </div>
        <br>
        <input id="progressbarSong" type="range" min="0" max="100" value="0" class="progress-bar">
        <!-- Reproductor de audio -->
        <source src="{{ song_url }}" type="audio/mpeg">
      </section>
    </section>
  </main>

  <!-- Script -->
  <script>
    const playlist = [];
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.song-item').forEach(item => {
        playlist.push(item.dataset.file); // Agrega las rutas a la lista de reproducción
      });
    });
  </script>
  <script src="{% static 'js/dashboardUser.js' %}"></script>

  <footer>
    <p>&copy; 2024 Groovify. Todos los derechos reservados.</p>
  </footer>
</body>

</html>